\section{Background}


\subsection{Lumines}
The video game Lumines was released in December 2004 in Japan for the PSP platform. The game was a major success for the developer Q Entertainment, and has since its original release been followed with a couple of sequels \cite{wiki:lumines}.
\begin{figure}[H]
    \centering
    \resizebox{0.7\textwidth}{!}{
    \begin{tikzpicture}
        \lummonowhite{0}{0}
        \lummonoblack{3}{0}
        \lumlwhite{6}{0}
        \lumlblack{9}{0}
        \lumh{12}{0}
        \lumx{15}{0}
    \end{tikzpicture}
    }
    \caption{The six pieces of lumines: M\{W,B\}, L\{W,B\}, H and X}
    \label{fig:pieces}
\end{figure}

Lumines is a two-dimensional grid game, in which a sequence of $2 \times 2$ dichromatic \textit{blocks} falls, and the user rotates and shifts the block before its bottom \text{cells} reaches other cells, \textit{terrain}, in the gameboard. When the block reach existing terrain, it is no longer possible to shift or rotate the block. If both bottom cells of the block is supported by existing terrain, the block stays put on that terrain. Otherwise, the half of the block that is not supported by terrain will fall down until it is. The player is then presented with the next block.

\begin{figure}[H]
    \centering
    \resizebox{0.7\textwidth}{!}{
    \begin{subfigure}[b]{0.45\linewidth}
        \resizebox{\linewidth}{!}{
        \begin{tikzpicture}
            \lumx{0}{4}
            \draw[thick, ->] (1,3.5) -- (1, 2.5);
            \lumx{0}{0}
            \draw [draw=none] rectangle (3, 7);
        \end{tikzpicture}
        \hspace{0.25cm}
        \begin{tikzpicture}
            \lumx{0}{2}
            \lumx{0}{0}
            \draw [draw=none] rectangle (3, 7);
        \end{tikzpicture}
        }
        \caption{}
    \end{subfigure}
    \hspace{0.05\linewidth}
    \begin{subfigure}[b]{0.45\linewidth}
        \resizebox{\linewidth}{!}{
        \begin{tikzpicture}
            \lumx{1}{4}
            \draw[thick, ->] (2,3.5) -- (2, 2.5);
            \lumx{0}{0}
            \draw [draw=none] rectangle (3, 7);
        \end{tikzpicture}
        \hspace{0.25cm}
        \begin{tikzpicture}
            \lumx{0}{0}
            \cellb{1}{2}
            \cellw{1}{3}
            \cellw{2}{0}
            \cellb{2}{1}
            \draw [draw=none] rectangle (3, 7);
        \end{tikzpicture}
        }
        \caption{}
    \end{subfigure}
    }
    \caption{Block behavior with and without supporting terrain}
\end{figure}

If at any point the player forms a monochromatic $2 \times 2$ square, all cells belonging to that square is \textit{marked}. Note that these squares may overlap, for example all cells within a monochromatic $2 \times 3$ rectangle is marked, since it consists of overlapping $2 \times 2$ monochromatic squares. At a regular pace a vertical \textit{sweep-line} scans the gameboard and removes all marked cells.

\begin{figure}[H]
    \centering
    \resizebox{0.7\textwidth}{!}{
        \begin{subfigure}[b]{.3\linewidth}
        \fbox{
        \begin{tikzpicture}
            \cellw{0}{0}
            \cellw{1}{0}
            \cellb{2}{0}
            \cellw{0}{1}
            \cellw{2}{1}
            \cellw{2}{2}
            \cellb{0}{5}
            \cellw{1}{5}
            \cellb{0}{6}
            \cellw{1}{6}
            \draw [draw=none] (0,0) rectangle (3, 8);
        \end{tikzpicture}
        }
        \end{subfigure}
        \begin{subfigure}[b]{.3\linewidth}
        \fbox{
        \begin{tikzpicture}
            \cellw{0}{0}
            \cellw{1}{0}
            \cellb{2}{0}
            \cellw{0}{1}
            \cellw{2}{1}
            \cellw{2}{2}
            \cellb{0}{2}
            \cellw{1}{1}
            \cellb{0}{3}
            \cellw{1}{2}
            \draw [draw=none] (0,0) rectangle (3, 8);
        \end{tikzpicture}
        }
        \end{subfigure}
        \begin{subfigure}[b]{.3\linewidth}
        \fbox{
        \begin{tikzpicture}
            \cellb{0}{2}
            \cellb{0}{3}
            \cellb{2}{0}
            \draw (0,0) [very thick, draw=black, fill=red] rectangle (2,2);
            \draw (1,1) [very thick, draw=black, fill=red] rectangle (3,3);
            \draw (1,1) [very thick, draw=black, fill=red] rectangle (2,2);
            \draw [draw=none] (0,0) rectangle (3, 8);
        \end{tikzpicture}
        }
        \end{subfigure}
    }
    \caption{Marking of $2 \times 2$ monochromatic squares (from \cite{lumines})}
\end{figure}

The version of Lumines found in actual video games is played on a $10 \times 16$-gameboard. The goal of the standard game mode in Lumines is to survive, to keep placing blocks inside the gameboard, for as long as possible and clear as much terrain as possible in the process. The blocks given to the player is generated randomly, and 3-block lookahead is provided. The game starts on partially filled gameboard, which varies in size depending on the difficulty level \cite{lumines}.

\subsection{Reduction}
A reduction is an algorithm used to solve one problem with another. A reduction of a decision problem is valid if each yes-instance gives a yes-instance and each no instance gives a no instance. If the reduction is to be made in polynomial time the problem that is solved must not be harder than the problem we reduce to.\cite{reduction}

\subsection{NP and PSPACE}
NP is the complexity class of all decision problems where a yes-instance can be verified in polynomial time. If it is possible to reduce all problems in NP to a certain problem, that problem is said to be NP-hard. A problem is referred to as a NP-complete problem if it is shown that it is both in NP and NP-hard. From this follows that if it is possible to reduce a NP-complete problem to some problem in NP using polynomial time, that problem is NP-complete as well.

PSPACE is the complexity class of all decision problems that can be solved by a Turing machine in a polynomial amount of memory space. Similar to NP-complete, a problem is PSPACE-complete if it is in PSPACE and all other problems in PSPACE can be reduced to the problem.

\subsection{The Subset Sum problem}

The \textit{Subset Sum} Problem is defined as follows \cite[p.~491]{algorithm}:

\begin{quote}
Given natural numbers $w_1, \ldots, w_n$, and a target number $W$, is there a subset of $\{w_1, \ldots, w_n \}$ that adds up precisely to $W$?
\end{quote}

The Subset Sum Problem plays a crucial role in this report; it is the chosen tproblem to reduce to the Lumines problem. It is known to be NP-complete \cite[p.~492]{algorithm}. In fact it is a special case of the Knapsack Problem \cite[p.~491]{algorithm}, one of Karp's 21 NP-complete problems he discusses in his 1972 paper \cite{karp}.

\subsection{Previous studies}
\subsubsection{Classical Nintendo Games}

In the paper on Classical Nintendo Games the computational complexity of games in the popular Nintendo series Legend of Zelda, Mario, Metroid, Donkey Kong and Pok√©mon are proven to be either NP- or PSPACE-hard. The paper states that it is easy to understand that most games are members of PSPACE because their behaviour is a deterministic function of the player's controller input. The paper focus on the reachability problem in the aforementioned games, that is if it is possible to get from point A to point B on a generalized gameboard. Using the NP-complete problem 3-SAT the authors build a framework of ``gadgets'' to prove NP-hardness. For PSPACE-hardness a similar framework is used with the True Quantified Boolean Formula. The framework gives the authors a simple way to show NP- and PSPACE-hardness by building the gadgets as gameboards in the respective games. The authors also use previous studies on the Push-1 \cite{push1} and PushPush-1 \cite{pushpushk} to show NP-hardness, respectively PSPACE-hardness in some of the games implementing these games as puzzles. 

\subsubsection{Lemmings}

Lemmings is a 2D puzzle-platformer game where the objective is to guide a couple of lemmings through obstacles to reach a designated exit. Much like the proof of the classical Nintendo games, the proof that Lemmings is NP-complete uses gadgets. The authors use the 3-SAT to prove NP-hardness. 

\subsubsection{Minesweeper}
Minesweeper is a popular puzzle game shipped with the Windows operating system. The author use SAT to prove NP-hardness by building Minesweeper configurations of logic circuits e.g. NOT-, AND- and XOR-gates \cite{minesweeper}.

\subsubsection{Match-three games}

Candy Crush and Bejeweled are both popular puzzle games with the same concept. The game consists of grids where each cell consists one ``gem''. The player is allowed to swap a gems position in vertical and horizontal directions if she is able to match three of a kind. When three of a kind is matched, the gems are ``popped'' and the gems above the now empty cells take their place. At the same time, the empty cells at the top are filled with new gems. The authors consider the offline version off Bejeweled for their studies and show NP-hardness using 1in3PSAT. \cite{candy}

\subsubsection{Tetris}

Tetris is a popular puzzle game where the player is given a sequence of tetrominoes to pack into a grid-based rectangular gameboard. If a row is completely filled it is cleared and all pieces above the cleared row is dropped by one row. Using the NP-complete 3-Partition problem the offline version of Tetris has been shown to be NP-complete considering specific goals, for example maximizing the number of cleared rows. The reduction is done by building a Tetris gameboard from instances of the 3-Partition problem. A specific sequence of pieces are defined for each number in the 3-Partition instance. The authors show that for every yes-instance of 3-Partition there exists a trajectory given the sequences which clear the entire gameboard without triggering a loss. An important note is that the reduction does not use all of the tetrominoes existing in the game and therefore is slightly simplified. In the same paper, it is also shown that Tetris is highly inapproximable. 

\subsection{Lumines and its similarities to Tetris}
\label{subsub:sim}

The existing research on Lumines largely focus on effective strategies. One paper states that there exists strategies that can never lose, no matter what sequence of pieces are dropped \cite{lumines}. This is different to Tetris where losing can be inevitable if the computer is allowed to change the sequence according to how the player organizes the pieces \textbf{todo: source}. Another relevant difference the brought up in prior research is that in Lumines it is possible to create terrain that can not be cleared, while in Tetris a gameboard can always be cleared if the player is given an appropriate sequence of pieces.

The standard Lumines game is played on a $10 \times 16$-gameboard, while standard Tetris is played on a $20 \times 10$-gameboard. In both games, when any block is fixed outside of the gameboard the player loses the game. While in Tetris a completed row is removed instantly, the marked cells in Lumines is not removed until the sweep-line has scanned the area.

The fact that falling blocks may seperate after being fixed in Lumines means that there aren't as many ways to build unique terrain as in Tetris. Nevertheless, some significant similarities exist between the two games making the existing research on Tetris a valuable asset when considering the complexity of Lumines.
